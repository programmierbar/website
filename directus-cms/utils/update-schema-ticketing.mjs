#!/usr/bin/env node
/**
 * Script to update schema.json with ticketing collections.
 * Adds ticket_orders and tickets collections for conference ticketing.
 *
 * Run with: node utils/update-schema-ticketing.mjs
 */

import { readFileSync, writeFileSync } from 'fs'
import { dirname, join } from 'path'
import { fileURLToPath } from 'url'

const __dirname = dirname(fileURLToPath(import.meta.url))
const schemaPath = join(__dirname, '..', 'schema.json')

// Read existing schema
const schema = JSON.parse(readFileSync(schemaPath, 'utf-8'))

// Helper to find max sort value in a collection
function getMaxSort(fields, collection) {
    return fields.filter((f) => f.collection === collection).reduce((max, f) => Math.max(max, f.meta?.sort || 0), 0)
}

// Helper to check if field exists
function fieldExists(fields, collection, fieldName) {
    return fields.some((f) => f.collection === collection && f.field === fieldName)
}

// Helper to check if collection exists
function collectionExists(collections, name) {
    return collections.some((c) => c.collection === name)
}

// Add ticketing_enabled field to conferences collection
function addTicketingFieldToConferences(schema) {
    console.log('Adding ticketing_enabled field to conferences...')
    let sort = getMaxSort(schema.fields, 'conferences') + 1

    const ticketingField = {
        collection: 'conferences',
        field: 'ticketing_enabled',
        type: 'boolean',
        meta: {
            collection: 'conferences',
            conditions: null,
            display: 'boolean',
            display_options: null,
            field: 'ticketing_enabled',
            group: null,
            hidden: false,
            interface: 'boolean',
            note: 'Enable internal ticket sales for this conference',
            options: null,
            readonly: false,
            required: false,
            searchable: true,
            sort: sort,
            special: ['cast-boolean'],
            translations: null,
            validation: null,
            validation_message: null,
            width: 'half',
        },
        schema: {
            name: 'ticketing_enabled',
            table: 'conferences',
            data_type: 'boolean',
            default_value: false,
            max_length: null,
            numeric_precision: null,
            numeric_scale: null,
            is_nullable: false,
            is_unique: false,
            is_indexed: false,
            is_primary_key: false,
            is_generated: false,
            generation_expression: null,
            has_auto_increment: false,
            foreign_key_table: null,
            foreign_key_column: null,
        },
    }

    if (!fieldExists(schema.fields, 'conferences', 'ticketing_enabled')) {
        schema.fields.push(ticketingField)
        console.log('  Added conferences.ticketing_enabled')
    } else {
        console.log('  conferences.ticketing_enabled already exists, skipping')
    }
}

// Add Ticketing folder collection
function addTicketingFolderCollection(schema) {
    console.log('Adding Ticketing folder collection...')

    if (!collectionExists(schema.collections, 'Ticketing')) {
        schema.collections.push({
            collection: 'Ticketing',
            meta: {
                accountability: 'all',
                archive_app_filter: true,
                archive_field: null,
                archive_value: null,
                collapse: 'open',
                collection: 'Ticketing',
                color: null,
                display_template: null,
                group: 'Collections',
                hidden: false,
                icon: 'confirmation_number',
                item_duplication_fields: null,
                note: null,
                preview_url: null,
                singleton: false,
                sort: 10,
                sort_field: null,
                translations: null,
                unarchive_value: null,
                versioning: false,
            },
        })
        console.log('  Added Ticketing folder collection')
    } else {
        console.log('  Ticketing folder already exists, skipping')
    }
}

// Add ticket_orders collection
function addTicketOrdersCollection(schema) {
    console.log('Adding ticket_orders collection...')

    if (!collectionExists(schema.collections, 'ticket_orders')) {
        schema.collections.push({
            collection: 'ticket_orders',
            meta: {
                accountability: 'all',
                archive_app_filter: true,
                archive_field: 'status',
                archive_value: 'cancelled',
                collapse: 'open',
                collection: 'ticket_orders',
                color: null,
                display_template: '{{order_number}} - {{purchaser_first_name}} {{purchaser_last_name}}',
                group: 'Ticketing',
                hidden: false,
                icon: 'receipt_long',
                item_duplication_fields: null,
                note: 'Conference ticket orders',
                preview_url: null,
                singleton: false,
                sort: 1,
                sort_field: null,
                translations: null,
                unarchive_value: 'pending',
                versioning: false,
            },
            schema: {
                name: 'ticket_orders',
            },
        })
        console.log('  Added ticket_orders collection')
    } else {
        console.log('  ticket_orders already exists, skipping')
    }

    // Add fields
    const fields = [
        {
            collection: 'ticket_orders',
            field: 'id',
            type: 'uuid',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: null,
                display_options: null,
                field: 'id',
                group: null,
                hidden: true,
                interface: 'input',
                note: null,
                options: null,
                readonly: true,
                required: false,
                searchable: true,
                sort: 1,
                special: ['uuid'],
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'id',
                table: 'ticket_orders',
                data_type: 'uuid',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: true,
                is_indexed: false,
                is_primary_key: true,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'order_number',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'order_number',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Human-readable order number (e.g., ORD-2026-ABC123)',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 2,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'order_number',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: true,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'conference',
            type: 'uuid',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'related-values',
                display_options: { template: '{{title}}' },
                field: 'conference',
                group: null,
                hidden: false,
                interface: 'select-dropdown-m2o',
                note: 'Related conference',
                options: { template: '{{title}}' },
                readonly: false,
                required: true,
                searchable: true,
                sort: 3,
                special: ['m2o'],
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'conference',
                table: 'ticket_orders',
                data_type: 'uuid',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: 'conferences',
                foreign_key_column: 'id',
            },
        },
        {
            collection: 'ticket_orders',
            field: 'status',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'labels',
                display_options: {
                    showAsDot: true,
                    choices: [
                        { value: 'pending', background: '#F59E0B', foreground: '#FFFFFF' },
                        { value: 'paid', background: '#10B981', foreground: '#FFFFFF' },
                        { value: 'cancelled', background: '#EF4444', foreground: '#FFFFFF' },
                    ],
                },
                field: 'status',
                group: null,
                hidden: false,
                interface: 'select-dropdown',
                note: 'Order status',
                options: {
                    choices: [
                        { text: 'Pending', value: 'pending' },
                        { text: 'Paid', value: 'paid' },
                        { text: 'Cancelled', value: 'cancelled' },
                    ],
                },
                readonly: false,
                required: true,
                searchable: true,
                sort: 4,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'status',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: 'pending',
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'purchase_type',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'labels',
                display_options: null,
                field: 'purchase_type',
                group: null,
                hidden: false,
                interface: 'select-dropdown',
                note: 'Personal or company purchase',
                options: {
                    choices: [
                        { text: 'Personal', value: 'personal' },
                        { text: 'Company', value: 'company' },
                    ],
                },
                readonly: false,
                required: true,
                searchable: true,
                sort: 5,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'purchase_type',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: 'personal',
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'purchaser_first_name',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'purchaser_first_name',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Purchaser first name',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 6,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'purchaser_first_name',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 100,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'purchaser_last_name',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'purchaser_last_name',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Purchaser last name',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 7,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'purchaser_last_name',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 100,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'purchaser_email',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'purchaser_email',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Purchaser email',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 8,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'purchaser_email',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 200,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'company_name',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'company_name',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Company name (for company purchases)',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 9,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'company_name',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 200,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'billing_address_line1',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'billing_address_line1',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Street address',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 10,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'billing_address_line1',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 200,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'billing_address_line2',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'billing_address_line2',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Additional address line',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 11,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'billing_address_line2',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 200,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'billing_city',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'billing_city',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'City',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 12,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'billing_city',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 100,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'billing_postal_code',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'billing_postal_code',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Postal code',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 13,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'billing_postal_code',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 20,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'billing_country',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'billing_country',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Country',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 14,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'billing_country',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 100,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'billing_email',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'billing_email',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Separate billing email (optional)',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 15,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'billing_email',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 200,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'subtotal_cents',
            type: 'integer',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'subtotal_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Subtotal in cents',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 16,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'subtotal_cents',
                table: 'ticket_orders',
                data_type: 'integer',
                default_value: 0,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'discount_amount_cents',
            type: 'integer',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'discount_amount_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Discount amount in cents',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 17,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'discount_amount_cents',
                table: 'ticket_orders',
                data_type: 'integer',
                default_value: 0,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'total_cents',
            type: 'integer',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'total_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Net total amount in cents (before VAT)',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 18,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'total_cents',
                table: 'ticket_orders',
                data_type: 'integer',
                default_value: 0,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'vat_amount_cents',
            type: 'integer',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'vat_amount_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'VAT amount in cents (19%)',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 19,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'vat_amount_cents',
                table: 'ticket_orders',
                data_type: 'integer',
                default_value: 0,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'total_gross_cents',
            type: 'integer',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'total_gross_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Gross total in cents (including VAT)',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 20,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'total_gross_cents',
                table: 'ticket_orders',
                data_type: 'integer',
                default_value: 0,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'discount_code_used',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'discount_code_used',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Discount code that was applied',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 21,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'discount_code_used',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'ticket_type',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'labels',
                display_options: {
                    showAsDot: true,
                    choices: [
                        { value: 'early_bird', background: '#10B981', foreground: '#FFFFFF' },
                        { value: 'regular', background: '#3B82F6', foreground: '#FFFFFF' },
                        { value: 'discounted', background: '#8B5CF6', foreground: '#FFFFFF' },
                    ],
                },
                field: 'ticket_type',
                group: null,
                hidden: false,
                interface: 'select-dropdown',
                note: 'Type of tickets in this order',
                options: {
                    choices: [
                        { text: 'Early Bird', value: 'early_bird' },
                        { text: 'Regular', value: 'regular' },
                        { text: 'Discounted', value: 'discounted' },
                    ],
                },
                readonly: false,
                required: false,
                searchable: true,
                sort: 22,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'ticket_type',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: 'regular',
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'attendees_json',
            type: 'json',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'attendees_json',
                group: null,
                hidden: false,
                interface: 'input-code',
                note: 'JSON array of attendees [{firstName, lastName, email}]',
                options: { language: 'json' },
                readonly: true,
                required: false,
                searchable: false,
                sort: 23,
                special: ['cast-json'],
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'attendees_json',
                table: 'ticket_orders',
                data_type: 'json',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'stripe_checkout_session_id',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'stripe_checkout_session_id',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Stripe Checkout Session ID',
                options: null,
                readonly: true,
                required: false,
                searchable: true,
                sort: 24,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'stripe_checkout_session_id',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 255,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'stripe_payment_intent_id',
            type: 'string',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'stripe_payment_intent_id',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Stripe Payment Intent ID',
                options: null,
                readonly: true,
                required: false,
                searchable: true,
                sort: 25,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'stripe_payment_intent_id',
                table: 'ticket_orders',
                data_type: 'character varying',
                default_value: null,
                max_length: 255,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'date_created',
            type: 'timestamp',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'datetime',
                display_options: { relative: true },
                field: 'date_created',
                group: null,
                hidden: false,
                interface: 'datetime',
                note: 'Order creation timestamp',
                options: null,
                readonly: true,
                required: false,
                searchable: true,
                sort: 26,
                special: ['date-created'],
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'date_created',
                table: 'ticket_orders',
                data_type: 'timestamp with time zone',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_orders',
            field: 'date_paid',
            type: 'timestamp',
            meta: {
                collection: 'ticket_orders',
                conditions: null,
                display: 'datetime',
                display_options: { relative: true },
                field: 'date_paid',
                group: null,
                hidden: false,
                interface: 'datetime',
                note: 'Payment completion timestamp',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 27,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'date_paid',
                table: 'ticket_orders',
                data_type: 'timestamp with time zone',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
    ]

    for (const field of fields) {
        if (!fieldExists(schema.fields, field.collection, field.field)) {
            schema.fields.push(field)
            console.log(`  Added ${field.collection}.${field.field}`)
        } else {
            console.log(`  ${field.collection}.${field.field} already exists, skipping`)
        }
    }

    // Add relation for conference
    const conferenceRelation = {
        collection: 'ticket_orders',
        field: 'conference',
        related_collection: 'conferences',
        meta: {
            junction_field: null,
            many_collection: 'ticket_orders',
            many_field: 'conference',
            one_allowed_collections: null,
            one_collection: 'conferences',
            one_collection_field: null,
            one_deselect_action: 'nullify',
            one_field: null,
            sort_field: null,
        },
        schema: {
            table: 'ticket_orders',
            column: 'conference',
            foreign_key_table: 'conferences',
            foreign_key_column: 'id',
            on_update: 'NO ACTION',
            on_delete: 'CASCADE',
            constraint_name: null,
        },
    }

    if (!schema.relations.some((r) => r.collection === 'ticket_orders' && r.field === 'conference')) {
        schema.relations.push(conferenceRelation)
        console.log('  Added relation ticket_orders.conference -> conferences')
    }
}

// Add tickets collection
function addTicketsCollection(schema) {
    console.log('Adding tickets collection...')

    if (!collectionExists(schema.collections, 'tickets')) {
        schema.collections.push({
            collection: 'tickets',
            meta: {
                accountability: 'all',
                archive_app_filter: true,
                archive_field: 'status',
                archive_value: 'cancelled',
                collapse: 'open',
                collection: 'tickets',
                color: null,
                display_template: '{{ticket_code}} - {{attendee_first_name}} {{attendee_last_name}}',
                group: 'Ticketing',
                hidden: false,
                icon: 'confirmation_number',
                item_duplication_fields: null,
                note: 'Individual conference tickets',
                preview_url: null,
                singleton: false,
                sort: 2,
                sort_field: null,
                translations: null,
                unarchive_value: 'valid',
                versioning: false,
            },
            schema: {
                name: 'tickets',
            },
        })
        console.log('  Added tickets collection')
    } else {
        console.log('  tickets already exists, skipping')
    }

    // Add fields
    const fields = [
        {
            collection: 'tickets',
            field: 'id',
            type: 'uuid',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: null,
                display_options: null,
                field: 'id',
                group: null,
                hidden: true,
                interface: 'input',
                note: null,
                options: null,
                readonly: true,
                required: false,
                searchable: true,
                sort: 1,
                special: ['uuid'],
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'id',
                table: 'tickets',
                data_type: 'uuid',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: true,
                is_indexed: false,
                is_primary_key: true,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'ticket_code',
            type: 'string',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'ticket_code',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Unique ticket code for QR (e.g., TKT-ABC123)',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 2,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'ticket_code',
                table: 'tickets',
                data_type: 'character varying',
                default_value: null,
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: true,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'order',
            type: 'uuid',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'related-values',
                display_options: { template: '{{order_number}}' },
                field: 'order',
                group: null,
                hidden: false,
                interface: 'select-dropdown-m2o',
                note: 'Parent order',
                options: { template: '{{order_number}}' },
                readonly: false,
                required: true,
                searchable: true,
                sort: 3,
                special: ['m2o'],
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'order',
                table: 'tickets',
                data_type: 'uuid',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: 'ticket_orders',
                foreign_key_column: 'id',
            },
        },
        {
            collection: 'tickets',
            field: 'conference',
            type: 'uuid',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'related-values',
                display_options: { template: '{{title}}' },
                field: 'conference',
                group: null,
                hidden: false,
                interface: 'select-dropdown-m2o',
                note: 'Conference reference',
                options: { template: '{{title}}' },
                readonly: false,
                required: true,
                searchable: true,
                sort: 4,
                special: ['m2o'],
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'conference',
                table: 'tickets',
                data_type: 'uuid',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: 'conferences',
                foreign_key_column: 'id',
            },
        },
        {
            collection: 'tickets',
            field: 'attendee_first_name',
            type: 'string',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'attendee_first_name',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Attendee first name',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 5,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'attendee_first_name',
                table: 'tickets',
                data_type: 'character varying',
                default_value: null,
                max_length: 100,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'attendee_last_name',
            type: 'string',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'attendee_last_name',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Attendee last name',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 6,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'attendee_last_name',
                table: 'tickets',
                data_type: 'character varying',
                default_value: null,
                max_length: 100,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'attendee_email',
            type: 'string',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'attendee_email',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Attendee email',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 7,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'attendee_email',
                table: 'tickets',
                data_type: 'character varying',
                default_value: null,
                max_length: 200,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'ticket_type',
            type: 'string',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'labels',
                display_options: {
                    showAsDot: true,
                    choices: [
                        { value: 'early_bird', background: '#10B981', foreground: '#FFFFFF' },
                        { value: 'regular', background: '#3B82F6', foreground: '#FFFFFF' },
                        { value: 'discounted', background: '#8B5CF6', foreground: '#FFFFFF' },
                    ],
                },
                field: 'ticket_type',
                group: null,
                hidden: false,
                interface: 'select-dropdown',
                note: 'Ticket type',
                options: {
                    choices: [
                        { text: 'Early Bird', value: 'early_bird' },
                        { text: 'Regular', value: 'regular' },
                        { text: 'Discounted', value: 'discounted' },
                    ],
                },
                readonly: false,
                required: true,
                searchable: true,
                sort: 8,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'ticket_type',
                table: 'tickets',
                data_type: 'character varying',
                default_value: 'regular',
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'price_cents',
            type: 'integer',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'price_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Price paid in cents',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 9,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'price_cents',
                table: 'tickets',
                data_type: 'integer',
                default_value: 0,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'status',
            type: 'string',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'labels',
                display_options: {
                    showAsDot: true,
                    choices: [
                        { value: 'valid', background: '#10B981', foreground: '#FFFFFF' },
                        { value: 'checked_in', background: '#3B82F6', foreground: '#FFFFFF' },
                        { value: 'cancelled', background: '#EF4444', foreground: '#FFFFFF' },
                    ],
                },
                field: 'status',
                group: null,
                hidden: false,
                interface: 'select-dropdown',
                note: 'Ticket status',
                options: {
                    choices: [
                        { text: 'Valid', value: 'valid' },
                        { text: 'Checked In', value: 'checked_in' },
                        { text: 'Cancelled', value: 'cancelled' },
                    ],
                },
                readonly: false,
                required: true,
                searchable: true,
                sort: 10,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'status',
                table: 'tickets',
                data_type: 'character varying',
                default_value: 'valid',
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: true,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'checked_in_at',
            type: 'timestamp',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'datetime',
                display_options: { relative: true },
                field: 'checked_in_at',
                group: null,
                hidden: false,
                interface: 'datetime',
                note: 'Check-in timestamp',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 11,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'checked_in_at',
                table: 'tickets',
                data_type: 'timestamp with time zone',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'tickets',
            field: 'date_created',
            type: 'timestamp',
            meta: {
                collection: 'tickets',
                conditions: null,
                display: 'datetime',
                display_options: { relative: true },
                field: 'date_created',
                group: null,
                hidden: false,
                interface: 'datetime',
                note: 'Ticket creation timestamp',
                options: null,
                readonly: true,
                required: false,
                searchable: true,
                sort: 12,
                special: ['date-created'],
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'date_created',
                table: 'tickets',
                data_type: 'timestamp with time zone',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
    ]

    for (const field of fields) {
        if (!fieldExists(schema.fields, field.collection, field.field)) {
            schema.fields.push(field)
            console.log(`  Added ${field.collection}.${field.field}`)
        } else {
            console.log(`  ${field.collection}.${field.field} already exists, skipping`)
        }
    }

    // Add relations
    const orderRelation = {
        collection: 'tickets',
        field: 'order',
        related_collection: 'ticket_orders',
        meta: {
            junction_field: null,
            many_collection: 'tickets',
            many_field: 'order',
            one_allowed_collections: null,
            one_collection: 'ticket_orders',
            one_collection_field: null,
            one_deselect_action: 'nullify',
            one_field: 'tickets',
            sort_field: null,
        },
        schema: {
            table: 'tickets',
            column: 'order',
            foreign_key_table: 'ticket_orders',
            foreign_key_column: 'id',
            on_update: 'NO ACTION',
            on_delete: 'CASCADE',
            constraint_name: null,
        },
    }

    if (!schema.relations.some((r) => r.collection === 'tickets' && r.field === 'order')) {
        schema.relations.push(orderRelation)
        console.log('  Added relation tickets.order -> ticket_orders')
    }

    const conferenceRelation = {
        collection: 'tickets',
        field: 'conference',
        related_collection: 'conferences',
        meta: {
            junction_field: null,
            many_collection: 'tickets',
            many_field: 'conference',
            one_allowed_collections: null,
            one_collection: 'conferences',
            one_collection_field: null,
            one_deselect_action: 'nullify',
            one_field: null,
            sort_field: null,
        },
        schema: {
            table: 'tickets',
            column: 'conference',
            foreign_key_table: 'conferences',
            foreign_key_column: 'id',
            on_update: 'NO ACTION',
            on_delete: 'CASCADE',
            constraint_name: null,
        },
    }

    if (!schema.relations.some((r) => r.collection === 'tickets' && r.field === 'conference')) {
        schema.relations.push(conferenceRelation)
        console.log('  Added relation tickets.conference -> conferences')
    }
}

// Add ticket_settings singleton collection
function addTicketSettingsCollection(schema) {
    console.log('Adding ticket_settings collection...')

    if (!collectionExists(schema.collections, 'ticket_settings')) {
        schema.collections.push({
            collection: 'ticket_settings',
            meta: {
                accountability: 'all',
                archive_app_filter: true,
                archive_field: null,
                archive_value: null,
                collapse: 'open',
                collection: 'ticket_settings',
                color: null,
                display_template: null,
                group: 'Ticketing',
                hidden: false,
                icon: 'settings',
                item_duplication_fields: null,
                note: 'Global ticket pricing and discount settings',
                preview_url: null,
                singleton: true,
                sort: 3,
                sort_field: null,
                translations: null,
                unarchive_value: null,
                versioning: false,
            },
            schema: {
                name: 'ticket_settings',
            },
        })
        console.log('  Added ticket_settings collection')
    } else {
        console.log('  ticket_settings already exists, skipping')
    }

    // Add fields
    const fields = [
        {
            collection: 'ticket_settings',
            field: 'id',
            type: 'integer',
            meta: {
                collection: 'ticket_settings',
                conditions: null,
                display: null,
                display_options: null,
                field: 'id',
                group: null,
                hidden: true,
                interface: 'input',
                note: null,
                options: null,
                readonly: true,
                required: false,
                searchable: true,
                sort: 1,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'full',
            },
            schema: {
                name: 'id',
                table: 'ticket_settings',
                data_type: 'integer',
                default_value: null,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: true,
                is_indexed: false,
                is_primary_key: true,
                is_generated: true,
                generation_expression: null,
                has_auto_increment: true,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_settings',
            field: 'early_bird_price_cents',
            type: 'integer',
            meta: {
                collection: 'ticket_settings',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'early_bird_price_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Early bird price in cents (e.g., 24900 for 249.00)',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 2,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'early_bird_price_cents',
                table: 'ticket_settings',
                data_type: 'integer',
                default_value: 24900,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_settings',
            field: 'regular_price_cents',
            type: 'integer',
            meta: {
                collection: 'ticket_settings',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'regular_price_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Regular price in cents (e.g., 34900 for 349.00)',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 3,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'regular_price_cents',
                table: 'ticket_settings',
                data_type: 'integer',
                default_value: 34900,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_settings',
            field: 'discounted_price_cents',
            type: 'integer',
            meta: {
                collection: 'ticket_settings',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'discounted_price_cents',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Discounted price in cents (e.g., 29900 for 299.00)',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 4,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'discounted_price_cents',
                table: 'ticket_settings',
                data_type: 'integer',
                default_value: 29900,
                max_length: null,
                numeric_precision: 32,
                numeric_scale: 0,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_settings',
            field: 'early_bird_deadline',
            type: 'timestamp',
            meta: {
                collection: 'ticket_settings',
                conditions: null,
                display: 'datetime',
                display_options: null,
                field: 'early_bird_deadline',
                group: null,
                hidden: false,
                interface: 'datetime',
                note: 'Early bird pricing ends after this date',
                options: null,
                readonly: false,
                required: true,
                searchable: true,
                sort: 5,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'early_bird_deadline',
                table: 'ticket_settings',
                data_type: 'timestamp with time zone',
                default_value: null,
                max_length: null,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: false,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
        {
            collection: 'ticket_settings',
            field: 'discount_code',
            type: 'string',
            meta: {
                collection: 'ticket_settings',
                conditions: null,
                display: 'raw',
                display_options: null,
                field: 'discount_code',
                group: null,
                hidden: false,
                interface: 'input',
                note: 'Valid discount code (case-insensitive)',
                options: null,
                readonly: false,
                required: false,
                searchable: true,
                sort: 6,
                special: null,
                translations: null,
                validation: null,
                validation_message: null,
                width: 'half',
            },
            schema: {
                name: 'discount_code',
                table: 'ticket_settings',
                data_type: 'character varying',
                default_value: null,
                max_length: 50,
                numeric_precision: null,
                numeric_scale: null,
                is_nullable: true,
                is_unique: false,
                is_indexed: false,
                is_primary_key: false,
                is_generated: false,
                generation_expression: null,
                has_auto_increment: false,
                foreign_key_table: null,
                foreign_key_column: null,
            },
        },
    ]

    for (const field of fields) {
        if (!fieldExists(schema.fields, field.collection, field.field)) {
            schema.fields.push(field)
            console.log(`  Added ${field.collection}.${field.field}`)
        } else {
            console.log(`  ${field.collection}.${field.field} already exists, skipping`)
        }
    }
}

// Add tickets field to ticket_orders (O2M relation)
function addTicketsFieldToOrders(schema) {
    console.log('Adding tickets field to ticket_orders...')

    const ticketsField = {
        collection: 'ticket_orders',
        field: 'tickets',
        type: 'alias',
        meta: {
            collection: 'ticket_orders',
            conditions: null,
            display: 'related-values',
            display_options: { template: '{{ticket_code}} - {{attendee_first_name}} {{attendee_last_name}}' },
            field: 'tickets',
            group: null,
            hidden: false,
            interface: 'list-o2m',
            note: 'Tickets in this order',
            options: { template: '{{ticket_code}} - {{attendee_first_name}} {{attendee_last_name}}' },
            readonly: false,
            required: false,
            searchable: true,
            sort: 28,
            special: ['o2m'],
            translations: null,
            validation: null,
            validation_message: null,
            width: 'full',
        },
        schema: null,
    }

    if (!fieldExists(schema.fields, 'ticket_orders', 'tickets')) {
        schema.fields.push(ticketsField)
        console.log('  Added ticket_orders.tickets')
    } else {
        console.log('  ticket_orders.tickets already exists, skipping')
    }
}

// Main function
function main() {
    console.log('=== Updating schema.json with ticketing collections ===\n')

    addTicketingFieldToConferences(schema)
    addTicketingFolderCollection(schema)
    addTicketOrdersCollection(schema)
    addTicketsCollection(schema)
    addTicketsFieldToOrders(schema)
    addTicketSettingsCollection(schema)

    // Write updated schema
    writeFileSync(schemaPath, JSON.stringify(schema, null, 2))
    console.log('\n=== Schema updated successfully ===')
    console.log(`Wrote to: ${schemaPath}`)
}

main()
